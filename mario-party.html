<!--
If you're not me, please go away, I don't want you looking at my badly organized code
At least, don't look at it too much
-->
<html>
    <head>
        <title>SUPER MARIO PARTY</title>
        <style>
            #stats {
                position: absolute;
                background-color: white;
                top: 5px;
                margin-top: 0px;
                padding-left: 5px;
                padding-right: 5px;
                left: 5px;
                border: 1px solid black;
            }
            #out {
                line-height: 16px;
            }
        </style>
    </head>
    <body>
        <p id="stats">★ Stats will be displayed here ★</p>
        <br/><br/>
        <pre id="board"></pre>
        <pre id="out"></pre>
        <script>
            alert("js loaded (If you are not Torin you can ignore this)");
            document.addEventListener('scroll', function(e) {
                document.getElementById("stats").style.top = window.scrollY;
            });
            let turn = 0;
            
            // CONFIG
            /*Length of the game     */ let maxTurns = 20;
            /*Names of players       */ let displayNames = {"p1": "Torin", "p2": "Mariobot", "p3": "Luigibot", "p4": "Toadbot"};
            /*What players are human */ let humans = ["p1"];
            /*Whether to log things  */ let logging = true;
            
            window.addEventListener('keydown', function (e) {
                let advanceIfBot = function(p) {
                    let isBot = false;
                    if(!humans.includes(p) && turn <= maxTurns) {
                        turn += 0.25;
                        advance(p);
                        isBot = true;
                        if(turn < maxTurns && p == "p4") {
                            log("=========", "====================================", "black");
                            log("Turn", "It's turn "+(turn+1)+((maxTurns-turn <= 3 && maxTurns-turn >= 2) ? ", we're in the <b>homestretch</b>!" : (maxTurns-turn == 1 ? ", this is the <b>final turn</b>!" : "")), "black");
                            for(let h of humans) {
                                let nextUp = [];
                                for(let i=1; i<11; i++) {
                                    nextUp.push((board+board)[space[h]+i]);
                                }
                                let shop = 17 - (space[h] > 16 ? space[h]-board.length : space[h]);
                                log("Spaces", displayNames[h]+"'s upcoming spaces: "+nextUp.join(", "), "black");
                            }
                            newLine();
                        }
                    }
                    if(turn >= maxTurns && p == "p4") {
                        log("Game Over", "<b>The game has ended!</b>", "crimson");
                        log("Winner", "🥇 <b>"+displayNames[findPlaces()[0]]+"</b> won the game!", "black");
                        log("2nd Place", "🥈 "+displayNames[findPlaces()[1]]+" got second place", "black");
                        log("3rd Place", "🥉 "+displayNames[findPlaces()[2]]+" got third place", "black");
                    }
                    return isBot;
                }
                if(e.key == " ") {
                    if(turn % 1 == 0 && turn <= maxTurns) {
                        turn += 0.25;
                        advance("p1");
                        if(advanceIfBot("p2")) {if(advanceIfBot("p3")) {advanceIfBot("p4");}}
                    } else if(turn % 1 == 0.25 && turn <= maxTurns) {
                        turn += 0.25;
                        advance("p2");
                        if(advanceIfBot("p3")) {if(advanceIfBot("p4")) {advanceIfBot("p1");}}
                    } else if(turn % 1 == 0.5 && turn <= maxTurns) {
                        turn += 0.25;
                        advance("p3");
                        if(advanceIfBot("p4")) {if(advanceIfBot("p1")) {advanceIfBot("p2");}}
                    } else if(turn % 1 == 0.75 && turn <= maxTurns) {
                        turn += 0.25;
                        advance("p4");
                        if(turn < maxTurns && humans.includes("p4")) {
                            log("=========", "====================================", "black");
                            log("Turn", "It's turn "+(turn+1)+((maxTurns-turn <= 3 && maxTurns-turn >= 2) ? ", we're in the <b>homestretch</b>!" : (maxTurns-turn == 1 ? ", this is the <b>final turn</b>!" : "")), "black");
                            for(let h of humans) {
                                let nextUp = [];
                                for(let i=1; i<11; i++) {
                                    nextUp.push((board+board)[space[h]+i]);
                                }
                                let shop = 17 - (space[h] > 16 ? space[h]-board.length : space[h]);
                                log("Spaces", displayNames[h]+"'s upcoming spaces: "+nextUp.join(", "), "black");
                            }
                            newLine();
                        }
                        if(advanceIfBot("p1")) {if(advanceIfBot("p2")) {advanceIfBot("p3");}}
                    } else {
                        log("Game Over", "<b>The game has ended!</b>", "crimson");
                        log("Winner", "🥇 <b>"+displayNames[findPlaces()[0]]+"</b> won the game!", "black");
                        log("2nd Place", "🥈 "+displayNames[findPlaces()[1]]+" got second place", "black");
                        log("3rd Place", "🥉 "+displayNames[findPlaces()[2]]+" got third place", "black");
                    }
                    displayStats();
                    
                } else if(e.key == "n") {
                    pickDice("Basic",       [1, 2, 3, 4, 5, 6]);
                } else if(e.key == "m") {
                    pickDice("Mario",       [1, 3, 3, 3, 5, 6]);
                } else if(e.key == "l") {
                    pickDice("Luigi",       [1, 1, 1, 5, 6, 7]);
                } else if(e.key == "p") {
                    pickDice("Pom Pom",     [0, 3, 3, 3, 3, 8]);
                } else if(e.key == "d") {
                    pickDice("Daisy",       [3, 3, 3, 3, 4, 4]);
                } else if(e.key == "w") {
                    pickDice("Wario",       [98, 98, 6, 6, 6, 6]);
                } else if(e.key == "y") {
                    pickDice("Yoshi",       [0, 1, 3, 3, 5, 7]);
                } else if(e.key == "r") {
                    pickDice("Rosalina",    [102, 102, 2, 3, 4, 8]);
                } else if(e.key == "k") {
                    pickDice("Donkey Kong", [105, 0, 0, 0, 10, 10]);
                } else if(e.key == "b") {
                    pickDice("Dry Bones",   [1, 1, 1, 6, 6, 6]);
                } else if(e.key == "g") {
                    pickDice("Goomba",      [102, 102, 3, 4, 5, 6]);
                } else if(e.key == "s") {
                    pickDice("Shy Guy",     [0, 4, 4, 4, 4, 4]);
                } else if(e.key == "o") {
                    pickDice("Bowser",      [97, 97, 1, 8, 9, 10]);
                } else if(e.key == "j") {
                    pickDice("Jr. Troopa",  [1, 1, 1, 4, 4, 9]);
                } else if(e.key == "h") {
                    pickDice("Hammer Bro",  [103, 1, 1, 5, 5, 5]);
                }
                
                if(e.key == "i") {
                    let curPlayer = (turn % 1 != 0 ? "p2" : "p1");
                    let itemUse = parseInt(prompt("Enter # of item to use. You have "+items[curPlayer].length+" items: "+items[curPlayer].join(", "), "ex. 2 for second item"), 10);
                    if(itemUse > 0 && itemUse <= items[curPlayer].length) {
                        let target = items[curPlayer][itemUse-1];
                        items[curPlayer].splice(itemUse-1, 1);
                        if(target == "mushroom") {
                            boosts[curPlayer] += 3;
                            log("Item", displayNames[curPlayer]+" used a mushroom (+3 to roll)", "brown");
                            displayStats();
                        } else if(target == "golden mushroom") {
                            boosts[curPlayer] += 5;
                            log("Item", displayNames[curPlayer]+" used a golden mushroom (+5 to roll)", "brown");
                            displayStats();
                        } else if(target == "poison mushroom") {
                            log("Item", displayNames[curPlayer]+" used a poison mushroom (-2 to all enemies' roll)", "brown");
                            boosts[curPlayer] += 2;
                            for(let p of ["p1", "p2", "p3", "p4"]) {
                                boosts[p] -= 2;
                            }
                            displayStats();
                        } else if(target == "custom dice") {
                            log("Item", displayNames[curPlayer]+" used a custom dice (choose next roll)", "brown");
                            custom[curPlayer] += 1;
                        } else if(target == "hidden block card") {
                            log("Item", displayNames[curPlayer]+" used a hidden block card (guaranteed hidden block)", "brown");
                            hblock[curPlayer] += 1;
                        } else if(target == "golden pipe") {
                            log("Item", displayNames[curPlayer]+" used a golden pipe (warp to the star)", "brown");
                            space[curPlayer] = board.length - 1;
                        }
                    }
                }
                
                if(e.key == "a") {
                    let curPlayer = (turn % 1 != 0 ? "p2" : "p1");
                    for(let target of items[curPlayer]) {
                        if(target == "mushroom") {
                            boosts[curPlayer] += 3;
                            log("Item", displayNames[curPlayer]+" used a mushroom (+3 to roll)", "brown");
                            displayStats();
                        } else if(target == "golden mushroom") {
                            boosts[curPlayer] += 5;
                            log("Item", displayNames[curPlayer]+" used a golden mushroom (+5 to roll)", "brown");
                            displayStats();
                        } else if(target == "poison mushroom") {
                            log("Item", displayNames[curPlayer]+" used a poison mushroom (-2 to all enemies' roll)", "brown");
                            boosts[curPlayer] += 2;
                            for(let p of ["p1", "p2", "p3", "p4"]) {
                                boosts[p] -= 2;
                            }
                            displayStats();
                        } else if(target == "custom dice") {
                            log("Item", displayNames[curPlayer]+" used a custom dice (choose next roll)", "brown");
                            custom[curPlayer] += 1;
                        } else if(target == "hidden block card") {
                            log("Item", displayNames[curPlayer]+" used a hidden block card (guaranteed hidden block)", "brown");
                            hblock[curPlayer] += 1;
                        } else if(target == "golden pipe") {
                            log("Item", displayNames[curPlayer]+" used a golden pipe (warp to the star)", "brown");
                            space[curPlayer] = board.length - 1;
                        }
                    }
                    items[curPlayer] = [];
                }
            }, false);
            
            let board = "blbrbibbbrlbbribbslbrbrlb"; // It's a bit random right now, I sometimes switch it up
            let asciiBoard = `
┌─┬─┬─┬─┬─┬─┬─┐\n
|B|L|B|R|B|I|B|\n
├─┼─┴─┴─┴─┴─┼─┤\n
│B│<-Star   │B│\n
├─┤         ├─┤\n
│L│         │B│\n
├─┤         ├─┤\n
│R│         │R│\n
├─┤         ├─┤\n
│B│         │L│\n
├─┤         ├─┤\n
│R│ [SHOP]  │B│\n
├─┼─┬─┬─┬─┬─┼─┤\n
│B│L│B│B│I│R│B│\n
└─┴─┴─┴─┴─┴─┴─┘`;
            let board2ascii = {0:17, 1:19, 2:21, 3:23, 4:25, 5:27, 6:29, 23:49, 7:61, 22:81, 8:93, 21:113, 9:125, 20:145, 10:157, 19:177, 11:189, 18:209, 17:211, 16:213, 15:215, 14:217, 13:219, 12:221};
            
            let newLine = function() {
                if(logging) document.getElementById("out").innerHTML += "\n";
            }
            let log = function(name, txt, color="black") {
                // Make sure 'name' is <= 10 chars
                if(logging) document.getElementById("out").innerHTML += "<span style='color: "+color+";'>"+name+" ".repeat(10-name.length)+"} "+txt+"</span>\n";
            };
            
            let blocks = [
                {name: "Basic", sides: [1, 2, 3, 4, 5, 6]},
                {name: "Mario", sides: [1, 3, 3, 3, 5, 6]},
                {name: "Luigi", sides: [1, 1, 1, 5, 6, 7]},
                {name: "Daisy", sides: [3, 3, 3, 3, 4, 4]},
                {name: "Wario", sides: [98, 98, 6, 6, 6, 6]},
                {name: "Yoshi", sides: [0, 1, 3, 3, 5, 7]},
                {name: "Rosalina", sides: [102, 102, 2, 3, 4, 8]},
                {name: "Donkey Kong", sides: [105, 0, 0, 0, 10, 10]},
                {name: "Bowser", sides: [97, 97, 1, 8, 9, 10]},
                {name: "Goomba", sides: [102, 102, 3, 4, 5, 6]},
                {name: "Shy Guy", sides: [0, 4, 4, 4, 4, 4]},
                {name: "Jr. Troopa", sides: [1, 1, 1, 4, 4, 9]},
                {name: "Hammer Bro", sides: [103, 1, 1, 5, 5, 5]},
                {name: "Dry Bones", sides: [1, 1, 1, 6, 6, 6]},
                {name: "Pom Pom", sides: [0, 3, 3, 3, 3, 8]}
            ]; // yes I get that this isn't the full list, this is only the blocks the players have access to
            
            let space = {"p1":0,"p2":0,"p3":0,"p4":0};
            let stars = {"p1":0,"p2":0,"p3":0,"p4":0};
            let coins = {"p1":10,"p2":10,"p3":10,"p4":10};
            let items = {"p1":[],"p2":[],"p3":[],"p4":[]};
            let boosts = {"p1":0,"p2":0,"p3":0,"p4":0};
            let custom = {"p1":0,"p2":0,"p3":0,"p4":0};
            let hblock = {"p1":0,"p2":0,"p3":0,"p4":0};
            let chosenDice = {"p1":[1, 2, 3, 4, 5, 6],"p2":[1, 2, 3, 4, 5, 6],"p3":[1, 2, 3, 4, 5, 6],"p4":[1, 2, 3, 4, 5, 6]};
            let chosenDiceName = {"p1":"Basic","p2":"Basic","p3":"Basic","p4":"Basic"};
            
            let displayStats = function() {
                if(humans.length >= 1 || turn > maxTurns) {
                    let stats = "Stats:";
                    let places = findPlaces();
                    let colors = {"p1":"red","p2":"blue","p3":"green","p4":"orange"};
                    for(let p of ["p1", "p2", "p3", "p4"]) {
                    stats += " | "+"<span style='color: "+colors[p]+";'>"+(places[0]==p ? "<b>" : "")+displayNames[p]+(places[0]==p ? "</b> (1st)" : (places[1]==p ? " (2nd)" : (places[2]==p ? " (3rd)" : " (4th)")))+"</span>: <b>"+stars[p]+"★</b>, "+coins[p]+"c, "+(board.length-space[p])+" to ★";
                    }
                    document.getElementById("stats").innerHTML = stats;
                }
            };
            
            let pickDice = function(name, nums) {
                let adjNums = [];
                for(let i of nums) {
                    if(i > 90) { adjNums.push((i-100)+"c"); } else { adjNums.push(i); }
                }
                log("Dice", "Selected the "+name+" Dice ("+adjNums.join(", ")+")", "gray");
                if(turn % 1 == 0) {
                    chosenDice["p1"] = nums;
                    chosenDiceName["p1"] = name;
                } else if(turn % 1 == 0.25) {
                    chosenDice["p2"] = nums;
                    chosenDiceName["p2"] = name;
                } else if(turn % 1 == 0.5) {
                    chosenDice["p3"] = nums;
                    chosenDiceName["p3"] = name;
                } else if(turn % 1 == 0.75) {
                    chosenDice["p4"] = nums;
                    chosenDiceName["p4"] = name;
                }
                displayStats();
                
            };
                    
            let findPlaces = function() {
                let players = ["p1", "p2", "p3", "p4"];
                let compare = function(a, b) {
                    if(stars[a] > stars[b] || (stars[a] == stars[b] && coins[a] > coins[b])) {
                        return -1;
                    }
                    if(stars[a] < stars[b] || (stars[a] == stars[b] && coins[a] < coins[b])) {
                        return 1;
                    }
                    return 0;
                };

                players.sort(compare);
                return players;
            };
            
            log("Controls", "Press space to roll", "black");
            log("Controls", "Press a letter key to change dice (usually 1st or 2nd letter of name)", "black");
            log("Controls", "Press I to use an item, press A to use them all", "black");
            log("Goal", "Travel around the board and get Stars, each one costs $20", "purple");
            log("Upcoming", "Look at the 'Upcoming spaces' to see what is ahead. b=blue, r=red, l=lucky, i=item, s=shop");
            log("Shop", "There's a shop that sells cool things. Save up $20 for a golden pipe");
            log("Length", "The game lasts for "+maxTurns+" turns, whoever has the most stars then wins", "black");
            log("=========", "====================================", "black");
            log("Turn", "It's turn 1", "black");
            log("Spaces", "Upcoming spaces: l, b, r, b, i, b, b, b, r, l", "black");
            newLine();
            
            let advance = function(player) {
                let roll;
                if(humans.includes(player)) { // check if player is a human
                    if(custom[player] > 0) {
                        let diceChoice = 0;
                        while( !(["1","2","3","4","5","6",1,2,3,4,5,6].includes(diceChoice)) ) {
                            diceChoice = prompt("You used a custom dice, pick what # to roll", "Enter 1-6");
                        }
                        custom[player] -= 1;
                        roll = parseInt(diceChoice);
                    } else {
                        log("Your Dice", "You're using the "+chosenDiceName[player]+" Dice", "darkorange");
                        roll = chosenDice[player][Math.floor(Math.random()*6)];
                    }
                } else { // AI goes here
                    let val;
                    let bestVal = -999;
                    let bestDice = 0; // I hope this works
                    if(items[player].length > 0) {log("Inventory", displayNames[player]+" has "+items[player].length+" item(s)", "brown");}
                    if(items[player].includes("golden pipe") && coins[player] >= 20 && space[player] <= 10) {
                        items[player].splice(items[player].indexOf("golden pipe"), 1);
                        log("Item", displayNames[player]+" used a golden pipe (warp to the star)", "brown");
                        space[player] = board.length - 1;
                    } else if(items[player].includes("golden mushroom") && board.length-space[player] > 2*(20-coins[player])) {
                        items[player].splice(items[player].indexOf("golden mushroom"), 1);
                        log("Item", displayNames[player]+" used a golden mushroom (+5 to roll)", "brown");
                        boosts[player] += 5;
                    } else if(items[player].includes("golden mushroom") && board.length-space[player] > 2*(20-coins[player])) {
                        items[player].splice(items[player].indexOf("mushroom"), 1);
                        log("Item", displayNames[player]+" used a mushroom (+3 to roll)", "brown");
                        boosts[player] += 3;
                    } else if(items[player].includes("poison mushroom")) {
                        items[player].splice(items[player].indexOf("poison mushroom"), 1);
                        log("Item", displayNames[player]+" used a poison mushroom (-2 to all enemies' roll)", "brown");
                        boosts[player] += 2;
                        for(let p of ["p1", "p2", "p3", "p4"]) {boosts[p] -= 2;}
                    } else if(items[player].includes("custom dice")) {
                        items[player].splice(items[player].indexOf("custom dice"), 1);
                        log("Item", displayNames[player]+" used a custom dice (choose next roll)", "brown");
                        custom[player] += 1;
                    } else if(items[player].includes("hidden block card")) {
                        items[player].splice(items[player].indexOf("hidden block card"), 1);
                        log("Item", displayNames[player]+" used a hidden block card (guaranteed hidden block)", "brown");
                        hblock[player] += 1;
                    }
                    if(custom[player] > 0) {
                        let choice = 0;
                        let choiceVal = -999;
                        for(let s of [1, 2, 3, 4, 5, 6]) {
                            val = 0;
                            if(s > 90) {
                                val += 20 * (s-100) / (20 + coins[player]);
                            } else {
                                let newSide = s + boosts[player];
                                let newSpaceNum = (space[player]+newSide) % board.length;
                                let newSpace = board[newSpaceNum];
                                if(coins[player] < 15) {
                                    val -= newSide; // you want coins first
                                } else {
                                    val += newSide; // big board = spaces less useful? no
                                }
                                if(newSpace == "b") {
                                    val -= (((coins[player] < 30 && maxTurns-turn >= 3) || coins[player] < 15) ? 3 : 0);
                                } else if(newSpace == "r") {
                                    val -= (((coins[player] < 30 && maxTurns-turn >= 3) || coins[player] < 15) ? 3 : 0);
                                } else if(newSpace == "l") {
                                    val += (((coins[player] < 30 && maxTurns-turn >= 3) || coins[player] < 15) ? (6.5 + findPlaces().indexOf(player)) : 0);
                                } else if(newSpace == "i" && (maxTurns-turn) < items[player].length) { // make sure you can use it
                                    val += 3.475 + (((coins[player] < 30 && maxTurns-turn >= 3) || coins[player] < 15) < 30 ? 1 : 0);
                                }
                            }
                            if(val > choiceVal) {
                                choiceVal = val;
                                choice = s;
                            }
                        }
                        roll = choice;
                    } else {
                        for(let b of blocks) {
                            val = 0;
                            for(let s of b.sides) {
                                if(s > 90) {
                                    val += 15 * (s-100) / (20 + coins[player]);
                                } else {
                                    let newSide = s + boosts[player];
                                    let newSpaceNum = (space[player]+newSide) % board.length;
                                    let newSpace = board[newSpaceNum];
                                    if(coins[player] < 15) {
                                        val -= newSide; // you want coins first
                                    } else {
                                        val += newSide; // big board = spaces less useful? no
                                    }
                                    if(newSpace == "b") {
                                        val += (((coins[player] < 30 && maxTurns-turn >= 3) || coins[player] < 15) ? 3 : 0);
                                    } else if(newSpace == "r") {
                                        val -= (((coins[player] < 30 && maxTurns-turn >= 3) || coins[player] < 15) ? 3 : 0);
                                    } else if(newSpace == "l") {
                                        val += (((coins[player] < 30 && maxTurns-turn >= 3) || coins[player] < 15) ? (6.5 + findPlaces().indexOf(player)) : 0);
                                    } else if(newSpace == "i" && (maxTurns-turn) < items[player].length) { // make sure you can use it
                                        val += 3.475 + (((coins[player] < 30 && maxTurns-turn >= 3) || coins[player] < 15) < 30 ? 1 : 0);
                                    }
                                }
                            }
                            if(val > bestVal) {
                                bestVal = val;
                                bestDice = blocks.indexOf(b);
                            }
                        }
                        log("AI Choice", "Dice choice: "+blocks[bestDice].name+" Dice", "orange");
                        roll = blocks[bestDice].sides[Math.floor(Math.random()*6)];
                    }
                }
                let prevSpace = space[player];
                if(roll > 90) { // +100 means coins
                    coins[player] = Math.max(0, coins[player]+roll-100);
                    log("Roll", displayNames[player]+" rolled <b>"+(roll-100)+"</b> coins", "black");
                    if(boosts[player] != 0) {
                        log("Roll", "... and also moved <b>"+boosts[player]+"</b> from their boost", "black");
                        space[player] += boosts[player];
                    }
                } else {
                    let totalRoll = Math.max(0, roll+boosts[player]);
                    if(boosts[player] != 0) {
                        log("Roll", displayNames[player]+" rolled a <b>"+roll+"</b> + <b>"+boosts[player]+"</b> (total: <b>"+(totalRoll)+"</b>)", "black");
                    } else {
                        log("Roll", displayNames[player]+" rolled a <b>"+roll+"</b>", "black");
                    }
                    space[player] += totalRoll;
                }
                if(prevSpace <= 16 && space[player] > 16) {
                    if(humans.includes(player)) {
                        let purchase = prompt("You passed a shop, choose what to buy: (You have $"+coins[player]+")\n1. mushroom ($5)\n2. golden mushroom ($10)\n3. golden pipe ($20)");
                        if(purchase == "1" && coins[player] >= 5) {
                            coins[player] -= 5; items[player].push("mushroom");
                            log("Purchase", "... bought a mushroom for 5 coins", "green");
                        } else if(purchase == "2" && coins[player] >= 10) {
                            coins[player] -= 10; items[player].push("golden mushroom");
                            log("Purchase", "... bought a golden mushroom for 10 coins", "green");
                        } else if(purchase == "3" && coins[player] >= 20) {
                            coins[player] -= 20; items[player].push("golden pipe");
                            log("Purchase", "... bought a golden pipe for 20 coins", "green");
                        } else {
                            log("Purchase", "... didn't buy anything from the shop", "green");
                        }
                    } else {
                        if(coins[player] >= 35) {
                            coins[player] -= 20; items[player].push("golden pipe");
                            log("Purchase", "... bought a golden pipe for 20 coins", "green");
                        } else {
                            log("Purchase", "... didn't buy anything from the shop", "green");
                        }
                    }
                }
                while(space[player] >= board.length) {
                    space[player] -= board.length;
                    if(coins[player] >= 20) {
                        coins[player] -= 20; stars[player] += 1;
                        log("Star", "... traded 20 coins for a <b>★Star</b>", "purple");
                    } else {
                        log("Star", "... couldn't afford the <b>★Star</b>", "purple");
                    }
                }
                let typ = board[space[player]];
                if(typ == "b") {
                    coins[player] += 3;
                    log("Space", "... gained 3 coins from a <b>Blue Space</b>", "blue");
                } else if(typ == "r") {
                    coins[player] = Math.max(0, coins[player]-3);
                    log("Space", "... lost 3 coins from a <b>Red Space</b>", "darkred");
                } else if(typ == "l") {
                    let gain = Math.floor(Math.random()*8) + 3 + findPlaces().indexOf(player);
                    coins[player] += gain;
                    log("Space", "... gained "+gain+" coins from a <b>Lucky Space</b>", "darkgreen");
                } else if(typ == "i") {
                    let reward;
                    let rng = Math.random();
                    if (rng < 0.125) {
                        reward = "golden mushroom";
                    } else if (rng < 0.25) {
                        reward = "poison mushroom";
                    } else if (rng < 0.375) {
                        reward = "custom dice";
                    } else if (rng < 0.5) {
                        reward = "hidden block card";
                    } else {
                        reward = "mushroom";
                    }
                    log("Space", "... got a "+reward+" from an <b>Item Space</b>", "chocolate");
                    items[player].push(reward);
                } else if(typ == "s") {
                    log("Space", "... landed on the <b>Shop Space</b>");
                }
                if(Math.random() < hblock[player] + (0.025 + 0.025 * findPlaces().indexOf(player)) * (turn / maxTurns)) {
                    log("HiddnBlock", "... just found a <b>hidden block</b> containing...", "orangered");
                    if(Math.random() < 0.15 + 0.05 * findPlaces().indexOf(player)) {
                        log("HiddnBlock", "... a <b>★Star</b>!", "orangered");
                        stars[player] += 1;
                    } else {
                        let reward = Math.round(Math.random()*(3 + findPlaces().indexOf(player))) + 6 + 2 * findPlaces().indexOf(player);
                        log("HiddnBlock", "... "+reward+" coins!", "orangered");
                        coins[player] += reward;
                    }
                }
                if(hblock[player]>0) {hblock[player] -= 1;}
                boosts[player] = 0;
                newLine();
            };
        </script>
    </body>
</html>